<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script type="module" src="https://esm.run/@material/web/all.js"></script>
<link rel="stylesheet" href="./css/site.css">
<link rel="stylesheet" href="./css/layout.css">
<link rel="stylesheet" href="./css/greenville.css">
<title>Greenville Associates Enterprise Software | Enterprise Products</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
.nav-tabs .nav-link.active {
    background-color: #198754;
    color: white;
    border-color: #198754 #198754 #fff;
}
.nav-tabs .nav-link {
    font-weight: 500;
}
.profile-card {
    width: 100% !important;
    max-width: 1600px !important;
    margin: 0 auto;
    font-size: 9pt;
    height: 500px;
    max-height: 800px;
    overflow-y: auto;
}
.tab-content, .tab-pane {
    width: 100% !important;
}
#editBtn {
    background-color: #198754;      /* Bootstrap success green */
    color: white;
    border: none;
    padding: 10px 22px;
    font-weight: 600;
    border-radius: 6px;
    transition: 0.2s ease-in-out;
}

#refreshBtn {
    background-color: lightgreen;      /* Bootstrap success green */
    color: white;
    border: none;
    padding: 10px 22px;
    font-weight: 600;
    border-radius: 6px;
    transition: 0.2s ease-in-out;
}
#refreshBtn:hover {
    background-color: #146c43;      /* darker green */
    transform: translateY(-1px);
}

    
#editBtn:hover {
    background-color: #146c43;      /* darker green */
    transform: translateY(-1px);
}

.action-bar {
    display: flex;
    justify-content: flex-end;      /* push buttons to the right */
    padding-right: 100px;           /* 100px from right edge */
    gap: 12px;
}
.btn-blue {
    background-color: #0d6efd;
    color: white;
    border: none;
    padding: 10px 22px;
    font-weight: 600;
    border-radius: 6px;
    transition: 0.2s ease-in-out;
}

.btn-blue:hover {
    background-color: #0b5ed7;
    transform: translateY(-1px);
}

    
</style>
</head>

<body>
<div class="container2">

<!-- NAVIGATION OMITTED FOR BREVITY (unchanged from your version) -->

<div class="pageheader">
    <hr>
    <span align="center"><h4>MyProfile</h4></span>
    <hr>
</div>

<!-- ACTION BAR -->
<div class="action-bar mb-6">
    <button class="btn" id="editBtn">Edit Contacts</button>
    <button class="btn btn-blue" id="editSocialBtn">Edit Social</button>
    <button class="btn btn-red" id="refreshBtn">Refresh</button>
</div>


<section class="top-section">

    <!-- PROFILE DISPLAY CARD WITH TABS -->
    <div class="card profile-card mb-4">
        <div class="card-header bg-success text-white fw-bold">
            My Profile
        </div>

        <div class="card-body">

            <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="basics-tab" data-bs-toggle="tab"
                        data-bs-target="#basics" type="button" role="tab">
                        Basics
                    </button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="social-tab" data-bs-toggle="tab"
                        data-bs-target="#social" type="button" role="tab">
                        Social Media
                    </button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contactpref-tab" data-bs-toggle="tab"
                        data-bs-target="#contactpref" type="button" role="tab">
                        Contact Preferences
                    </button>
                </li>
            </ul>

            <div class="tab-content mt-3" id="profileTabsContent">

                <div class="tab-pane fade show active" id="basics" role="tabpanel">
                    <div id="profileBasics">Loading...</div>
                </div>

                <div class="tab-pane fade" id="social" role="tabpanel">
                    <div id="profileSocial">Loading...</div>
                </div>

                <div class="tab-pane fade" id="contactpref" role="tabpanel">
                    <div id="profileContactPref">Loading...</div>
                </div>

            </div>
        </div>
    </div>
<!-- UPDATE SOCIAL MEDIA MODAL -->
<div class="modal fade" id="socialModal" tabindex="-1">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <div class="modal-header table-header-green">
                <h5 class="modal-title">Edit Social Media</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <form id="socialForm" class="row g-3">

                    <div class="col-12">
                        <label class="profile-label">LinkedIn</label>
                        <input class="form-control" name="linkedin">
                    </div>

                    <div class="col-12">
                        <label class="profile-label">Twitter</label>
                        <input class="form-control" name="twitter">
                    </div>

                    <div class="col-12">
                        <label class="profile-label">Facebook</label>
                        <input class="form-control" name="facebook">
                    </div>

                    <div class="col-12">
                        <label class="profile-label">Instagram</label>
                        <input class="form-control" name="instagram">
                    </div>

                </form>
            </div>

            <div class="modal-footer">
                <button class="btn btn-black" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-green-dark" id="saveSocialBtn">Save Social</button>
            </div>

        </div>
    </div>
</div>

    <!-- UPDATE PROFILE MODAL -->
    <div class="modal fade" id="updateModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header table-header-green">
                    <h5 class="modal-title">Update Profile</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form id="updateForm" class="row g-3">

                        <div class="profile-section-title">Basic Information</div>

                        <div class="col-md-6">
                            <label class="profile-label">First Name</label>
                            <input class="form-control" name="firstname">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Last Name</label>
                            <input class="form-control" name="lastname">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Display Name</label>
                            <input class="form-control" name="displayname">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Username</label>
                            <input class="form-control" name="username">
                        </div>

                        <div class="profile-section-title">Contact</div>

                        <div class="col-md-6">
                            <label class="profile-label">Email</label>
                            <input class="form-control" name="email">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Phone</label>
                            <input class="form-control" name="phone">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Cell Phone</label>
                            <input class="form-control" name="cellphone">
                        </div>

                        <div class="profile-section-title">Address</div>

                        <div class="col-md-6">
                            <label class="profile-label">Address 1</label>
                            <input class="form-control" name="address1">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Address 2</label>
                            <input class="form-control" name="address2">
                        </div>

                        <div class="col-md-4">
                            <label class="profile-label">City</label>
                            <input class="form-control" name="city">
                        </div>

                        <div class="col-md-4">
                            <label class="profile-label">State</label>
                            <input class="form-control" name="state">
                        </div>

                        <div class="col-md-4">
                            <label class="profile-label">Postal/Zip</label>
                            <input class="form-control" name="postalzip">
                        </div>

                        <div class="col-md-6">
                            <label class="profile-label">Country</label>
                            <input class="form-control" name="country">
                        </div>

                    </form>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-black" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-green-dark" id="saveBtn">Save Changes</button>
                </div>

            </div>
        </div>
    </div>

</section>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- FULL WORKING SCRIPT -->
<script>
const API_BASE = "https://api242.onrender.com";

// Load UID from localStorage or use default Mongo-generated ID
let uid = localStorage.getItem("uid");

if (!uid) {
    uid = "6996382c2ee4254a4978d94c";
    localStorage.setItem("uid", uid);
}

// Load profile
async function loadProfile() {
    console.log("GET URL:", `${API_BASE}/users/${uid}`);

    const res = await fetch(`${API_BASE}/users/${uid}`);
    const data = await res.json();

    console.log("GET Response:", data);

    window.profileData = data;
    renderProfile(data);
}

// Render profile into tab sections
function renderProfile(p) {

    // BASICS TAB
    document.getElementById("profileBasics").innerHTML = `
        <p><strong>Name:</strong> ${p.fullname}</p>
        <p><strong>Username:</strong> ${p.username}</p>
        <p><strong>Display Name:</strong> ${p.displayname}</p>
    `;

    // SOCIAL MEDIA TAB
    document.getElementById("profileSocial").innerHTML = `
        <p><strong>LinkedIn:</strong> ${p.linkedin || "Not provided"}</p>
        <p><strong>Twitter:</strong> ${p.twitter || "Not provided"}</p>
        <p><strong>Facebook:</strong> ${p.facebook || "Not provided"}</p>
        <p><strong>Instagram:</strong> ${p.instagram || "Not provided"}</p>
    `;

    // CONTACT PREFERENCES TAB
    document.getElementById("profileContactPref").innerHTML = `
        <p><strong>Email:</strong> ${p.email}</p>
        <p><strong>Phone:</strong> ${p.phone}</p>
        <p><strong>Cell:</strong> ${p.cellphone}</p>
        <p><strong>Preferred Contact:</strong> ${p.preferredcontact || "Not set"}</p>

        <hr>

        <p><strong>Address:</strong> ${p.address1} ${p.address2 || ""}</p>
        <p><strong>City:</strong> ${p.city}</p>
        <p><strong>State:</strong> ${p.state}</p>
        <p><strong>Postal:</strong> ${p.postalzip}</p>
        <p><strong>Country:</strong> ${p.country}</p>
    `;
}

// Open modal with existing values
document.getElementById("editBtn").onclick = () => {
    const form = document.getElementById("updateForm");

    Object.keys(window.profileData).forEach(key => {
        if (form[key]) form[key].value = window.profileData[key] || "";
    });

    new bootstrap.Modal(document.getElementById("updateModal")).show();
};

// Save changes
document.getElementById("saveBtn").onclick = async () => {
    const form = document.getElementById("updateForm");
    const formData = Object.fromEntries(new FormData(form).entries());

    console.log("PUT URL:", `${API_BASE}/users/${uid}`);
    console.log("PUT Payload:", formData);

    const res = await fetch(`${API_BASE}/users/${uid}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
    });

    console.log("PUT Response Status:", res.status);

    if (!res.ok) {
        console.error("PUT failed:", await res.text());
        alert("Error saving profile");
        return;
    }

    loadProfile();
    bootstrap.Modal.getInstance(document.getElementById("updateModal")).hide();
};

document.getElementById("saveSocialBtn").onclick = async () => {
    const form = document.getElementById("socialForm");
    const socialData = Object.fromEntries(new FormData(form).entries());

    const updated = {
        ...window.profileData,
        ...socialData
    };

    const res = await fetch(`${API_BASE}/users/${uid}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updated)
    });

    if (!res.ok) {
        alert("Error saving social media");
        return;
    }

    loadProfile();
    bootstrap.Modal.getInstance(document.getElementById("socialModal")).hide();
};

document.getElementById("editSocialBtn").onclick = () => {
    const form = document.getElementById("socialForm");

    ["linkedin", "twitter", "facebook", "instagram"].forEach(key => {
        form[key].value = window.profileData[key] || "";
    });

    new bootstrap.Modal(document.getElementById("socialModal")).show();
};
    

document.getElementById("refreshBtn").onclick = loadProfile;

loadProfile();
</script>

</body>
</html>
